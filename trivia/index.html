<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NP History Trivia | Ngee Ann Polytechnic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #014689;
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
            margin: 10px 0;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .mode-selector {
            padding: 40px;
            text-align: center;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .mode-card {
            background: linear-gradient(135deg, #014689 0%, #0a5aa3 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(1, 70, 137, 0.3);
            border: none;
            text-align: center;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(1, 70, 137, 0.4);
        }

        .mode-card i {
            font-size: 3rem;
            color: #feb041;
            margin-bottom: 20px;
        }

        .mode-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #feb041;
        }

        .mode-card p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .input-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #014689;
        }

        .btn-primary {
            background: linear-gradient(135deg, #014689 0%, #0a5aa3 100%);
            color: #feb041;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(1, 70, 137, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(1, 70, 137, 0.4);
        }

        .btn-secondary {
            background: #feb041;
            color: #014689;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(254, 176, 65, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(254, 176, 65, 0.4);
        }

        .question-container {
            padding: 40px;
            text-align: center;
        }

        .question-text {
            font-size: 1.8rem;
            color: #014689;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .option-button {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            color: #333;
        }

        .option-button:hover {
            background: rgba(1, 70, 137, 0.1);
            border-color: #014689;
        }

        .option-correct {
            background: rgba(34, 197, 94, 0.2) !important;
            border-color: #22c55e !important;
            color: #15803d !important;
        }

        .option-wrong {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: #ef4444 !important;
            color: #dc2626 !important;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #014689, #feb041);
            transition: width 0.5s ease;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(1, 70, 137, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .player-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #014689;
        }

        .pvp-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .player-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-1 {
            border-left: 4px solid #014689;
        }

        .player-2 {
            border-left: 4px solid #feb041;
        }

        .group-code {
            font-size: 2rem;
            font-weight: bold;
            color: #014689;
            background: #feb041;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 3px;
        }

        .participants-list {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .participant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .participant:last-child {
            border-bottom: none;
        }

        .hidden {
            display: none;
        }

        .timer {
            font-size: 3rem;
            font-weight: bold;
            color: #ef4444;
            text-align: center;
            margin: 20px 0;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank {
            font-size: 1.2rem;
            font-weight: bold;
            color: #014689;
            width: 40px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>NP History Trivia</h1>
        <p>Test your knowledge about Ngee Ann Polytechnic's heritage</p>
    </div>

    <div class="game-container">
        <!-- Mode Selection Screen -->
        <div id="mode-selection" class="mode-selector">
            <h2 style="color: #014689; font-size: 2rem; margin-bottom: 20px;">Choose Your Game Mode</h2>
            <div class="mode-grid">
                <button class="mode-card" onclick="selectMode('individual')">
                    <i class="fas fa-user"></i>
                    <h3>Individual Mode</h3>
                    <p>Test your knowledge solo. Enter your student ID and compete for the best score!</p>
                </button>
                <button class="mode-card" onclick="selectMode('pvp')">
                    <i class="fas fa-users"></i>
                    <h3>PvP Mode</h3>
                    <p>Challenge a friend! Two players compete head-to-head on the same screen.</p>
                </button>
                <button class="mode-card" onclick="selectMode('group')">
                    <i class="fas fa-users-cog"></i>
                    <h3>Group Mode</h3>
                    <p>Kahoot-style multiplayer! Host a game and let others join with a code.</p>
                </button>
            </div>
        </div>

        <!-- Overall Leaderboard Section -->
        <div id="overall-leaderboard" class="mode-selector">
            <h2 style="color: #014689; font-size: 2rem; margin-bottom: 20px;">Overall Leaderboard</h2>
            <div style="background: rgba(255, 255, 255, 0.9); border-radius: 15px; padding: 30px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #014689; margin: 0;">Top Players This Month</h3>
                    <button class="btn-secondary" onclick="refreshLeaderboard()" style="padding: 10px 20px; font-size: 0.9rem;">
                        <i class="fas fa-refresh"></i> Refresh
                    </button>
                </div>
                <div id="overall-leaderboard-container">
                    <!-- Leaderboard will be populated here -->
                </div>
            </div>
        </div>

        <!-- Individual Mode Setup -->
        <div id="individual-setup" class="hidden">
            <div style="padding: 40px; text-align: center;">
                <h2 style="color: #014689; font-size: 2rem; margin-bottom: 30px;">Individual Mode</h2>
                <div class="input-container">
                    <label for="student-name" style="display: block; margin-bottom: 10px; font-weight: bold; color: #014689;">Enter Your Name:</label>
                    <input type="text" id="student-name" class="input-field" placeholder="e.g., John Doe" maxlength="50">
                </div>
                <div class="input-container">
                    <label for="student-id" style="display: block; margin-bottom: 10px; font-weight: bold; color: #014689;">Enter Your Student ID:</label>
                    <input type="text" id="student-id" class="input-field" placeholder="e.g., S1234567A" maxlength="10">
                </div>
                <div style="margin-top: 30px;">
                    <button class="btn-primary" onclick="startIndividualGame()">Start Game</button>
                    <button class="btn-secondary" onclick="backToModeSelection()" style="margin-left: 20px;">Back</button>
                </div>
            </div>
        </div>

        <!-- PvP Mode Setup -->
        <div id="pvp-setup" class="hidden">
            <div style="padding: 40px; text-align: center;">
                <h2 style="color: #014689; font-size: 2rem; margin-bottom: 30px;">PvP Mode</h2>
                <div class="pvp-container">
                    <div class="player-section player-1">
                        <h3 style="color: #014689; margin-bottom: 20px;">Player 1</h3>
                        <div class="input-container" style="margin-bottom: 15px;">
                            <input type="text" id="player1-name" class="input-field" placeholder="Enter your name">
                        </div>
                        <div class="input-container">
                            <input type="text" id="player1-id" class="input-field" placeholder="Enter your student ID">
                        </div>
                    </div>
                    <div class="player-section player-2">
                        <h3 style="color: #feb041; margin-bottom: 20px;">Player 2</h3>
                        <div class="input-container" style="margin-bottom: 15px;">
                            <input type="text" id="player2-name" class="input-field" placeholder="Enter your name">
                        </div>
                        <div class="input-container">
                            <input type="text" id="player2-id" class="input-field" placeholder="Enter your student ID">
                        </div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <button class="btn-primary" onclick="startPvPGame()">Start Battle</button>
                    <button class="btn-secondary" onclick="backToModeSelection()" style="margin-left: 20px;">Back</button>
                </div>
            </div>
        </div>

        <!-- Group Mode Setup -->
        <div id="group-setup" class="hidden">
            <div style="padding: 40px; text-align: center;">
                <h2 style="color: #014689; font-size: 2rem; margin-bottom: 30px;">Group Mode</h2>
                <div style="margin-bottom: 30px;">
                    <button class="btn-primary" onclick="createRoom()">Create Room</button>
                    <button class="btn-secondary" onclick="joinRoom()" style="margin-left: 20px;">Join Room</button>
                </div>
                <button class="btn-secondary" onclick="backToModeSelection()">Back</button>
            </div>
        </div>

        <!-- Group Room -->
        <div id="group-room" class="hidden">
            <div style="padding: 40px; text-align: center;">
                <h2 style="color: #014689; font-size: 2rem; margin-bottom: 20px;">Waiting Room</h2>
                <div id="room-code" class="group-code">ROOM123</div>
                <p style="color: #666; font-size: 1.1rem; margin-bottom: 30px;">Share this code with participants</p>
                
                <div class="participants-list">
                    <h3 style="color: #014689; margin-bottom: 15px;">Participants (<span id="participant-count">0</span>)</h3>
                    <div id="participants-container">
                        <!-- Participants will be added here -->
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn-primary" onclick="startGroupGame()" id="start-group-btn" disabled>Start Game (Min 2 players)</button>
                    <button class="btn-secondary" onclick="backToModeSelection()" style="margin-left: 20px;">Back</button>
                </div>
            </div>
        </div>

        <!-- Join Room -->
        <div id="join-room" class="hidden">
            <div style="padding: 40px; text-align: center;">
                <h2 style="color: #014689; font-size: 2rem; margin-bottom: 30px;">Join Room</h2>
                <div class="input-container">
                    <label for="room-code-input" style="display: block; margin-bottom: 10px; font-weight: bold; color: #014689;">Enter Room Code:</label>
                    <input type="text" id="room-code-input" class="input-field" placeholder="e.g., ROOM123" maxlength="7">
                </div>
                <div class="input-container">
                    <label for="participant-name" style="display: block; margin-bottom: 10px; font-weight: bold; color: #014689;">Your Name:</label>
                    <input type="text" id="participant-name" class="input-field" placeholder="Enter your name">
                </div>
                <div style="margin-top: 30px;">
                    <button class="btn-primary" onclick="joinRoomWithCode()">Join Room</button>
                    <button class="btn-secondary" onclick="backToGroupSetup()" style="margin-left: 20px;">Back</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <div class="question-container">
                <div class="player-info">
                    <div>
                        <span id="current-player">Player</span>
                        <div class="player-score">Score: <span id="player-score">0</span></div>
                    </div>
                    <div>
                        <span id="question-counter">Question 1 of 10</span>
                        <div class="timer" id="timer">15</div>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="question-text" id="question-text">Loading question...</div>
                
                <div class="options-grid" id="options-container">
                    <!-- Options will be populated here -->
                </div>
                
                <div id="feedback" class="hidden" style="margin-top: 20px; padding: 20px; background: rgba(255, 255, 255, 0.9); border-radius: 10px;">
                    <div id="feedback-text"></div>
                </div>
            </div>
        </div>

        <!-- PvP Game Screen -->
        <div id="pvp-game-screen" class="hidden">
            <div class="question-container">
                <div class="timer" id="pvp-timer">15</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="pvp-progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="question-text" id="pvp-question-text">Loading question...</div>
                
                <div class="pvp-container">
                    <div class="player-section player-1">
                        <h3 id="pvp-player1-name">Player 1</h3>
                        <div class="player-score">Score: <span id="pvp-player1-score">0</span></div>
                        <div class="options-grid" id="pvp-player1-options">
                            <!-- Player 1 options -->
                        </div>
                    </div>
                    <div class="player-section player-2">
                        <h3 id="pvp-player2-name">Player 2</h3>
                        <div class="player-score">Score: <span id="pvp-player2-score">0</span></div>
                        <div class="options-grid" id="pvp-player2-options">
                            <!-- Player 2 options -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Group Game Screen -->
        <div id="group-game-screen" class="hidden">
            <div class="question-container">
                <div class="timer" id="group-timer">15</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="group-progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="question-text" id="group-question-text">Loading question...</div>
                
                <div class="options-grid" id="group-options-container">
                    <!-- Options will be populated here -->
                </div>
                
                <div class="leaderboard">
                    <h3 style="color: #014689; margin-bottom: 15px;">Live Leaderboard</h3>
                    <div id="leaderboard-container">
                        <!-- Leaderboard will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden">
            <div style="padding: 40px; text-align: center;">
                <h2 id="results-title" style="color: #014689; font-size: 2.5rem; margin-bottom: 20px;">Game Over!</h2>
                <div id="results-content">
                    <!-- Results will be populated here -->
                </div>
                <div style="margin-top: 30px;">
                    <button class="btn-primary" onclick="playAgain()">Play Again</button>
                    <button class="btn-secondary" onclick="backToModeSelection()" style="margin-left: 20px;">Main Menu</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game Data
        const questions = [
            {
                question: "In what year was Ngee Ann Polytechnic established?",
                options: ["1963", "1968", "1972", "1980"],
                correctAnswer: 0,
                feedback: "Ngee Ann Polytechnic started in 1963 and is today one of Singapore's leading institutions of higher learning with over 13,000 enrolled full-time students in more than 40 courses across 8 academic schools."
            },
            {
                question: "Which of these notable landmarks is NOT located within NP's campus?",
                options: ["The Clock Tower", "The Heritage Gallery", "The Dragon Fountain", "The Merlion Statue"],
                correctAnswer: 3,
                feedback: "While NP has many iconic landmarks including the Clock Tower, Heritage Gallery, and Dragon Fountain, the Merlion Statue is located at Marina Bay."
            },
            {
                question: "What was the original name of Ngee Ann Polytechnic",
                options: ["Ngee Ann Technical College", "Ngee Ann University College", "Ngee Ann College", "Ngee Ann Institute"],
                correctAnswer: 2,
                feedback: "The institution was originally known as Ngee Ann College, offering pre-university courses."
            },
            {
                question: "Which faculty at NP was the first to be established?",
                options: ["School of Business & Accountancy", "School of Engineering", "School of Film & Media Studies", "School of Life Sciences"],
                correctAnswer: 1,
                feedback: "The School of Engineering was the first faculty established at Ngee Ann Polytechnic, reflecting Singapore's early focus on technical education."
            },
            {
                question: "Which of these famous personalities is NOT an NP alumnus?",
                options: ["Michelle Chong (Media Personality)", "Pierre Png (Actor)", "Rebecca Lim (Actress)", "Ivan Heng (Theatre Director)"],
                correctAnswer: 3,
                feedback: "While Michelle Chong, Pierre Png, and Rebecca Lim are all NP alumni, Ivan Heng studied at the National University of Singapore."
            },
            {
                question: "What was the original campus location before moving to Clementi Road?",
                options: ["Bukit Timah", "Orchard Road", "Tanjong Pagar", "Bras Basah"],
                correctAnswer: 0,
                feedback: "Ngee Ann College was originally located at Bukit Timah before moving to its current Clementi Road campus in the 1980s."
            }
        ];

        // Game State
        let currentMode = '';
        let currentQuestionIndex = 0;
        let gameQuestions = [];
        let timer = null;
        let timeLeft = 15;
        
        // Individual Mode State
        let individualScore = 0;
        let studentId = '';
        let studentName = '';
        
        // PvP Mode State
        let pvpPlayers = {
            player1: { name: '', score: 0, answered: false },
            player2: { name: '', score: 0, answered: false }
        };
        
        // Group Mode State
        let groupRoom = {
            code: '',
            participants: [],
            host: false,
            gameStarted: false
        };

        // Utility Functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = 'ROOM';
            for (let i = 0; i < 3; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function hideAllScreens() {
            document.querySelectorAll('.game-container > div').forEach(screen => {
                screen.classList.add('hidden');
            });
        }

        function startTimer(callback) {
            timeLeft = 15;
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    callback();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerElements = document.querySelectorAll('.timer');
            timerElements.forEach(element => {
                element.textContent = timeLeft;
                element.style.color = timeLeft <= 5 ? '#ef4444' : '#014689';
            });
        }

        function updateProgressBar(current, total, elementId) {
            const progressPercent = (current / total) * 100;
            document.getElementById(elementId).style.width = `${progressPercent}%`;
        }

        // Mode Selection Functions
        function selectMode(mode) {
            currentMode = mode;
            hideAllScreens();
            
            switch (mode) {
                case 'individual':
                    document.getElementById('individual-setup').classList.remove('hidden');
                    break;
                case 'pvp':
                    document.getElementById('pvp-setup').classList.remove('hidden');
                    break;
                case 'group':
                    document.getElementById('group-setup').classList.remove('hidden');
                    break;
            }
        }

        function backToModeSelection() {
            hideAllScreens();
            document.getElementById('mode-selection').classList.remove('hidden');
            resetGameState();
        }

        function resetGameState() {
            currentQuestionIndex = 0;
            gameQuestions = [];
            individualScore = 0;
            studentName='';
            pvpPlayers = {
                player1: { name: '', score: 0, answered: false },
                player2: { name: '', score: 0, answered: false }
            };
            groupRoom = {
                code: '',
                participants: [],
                host: false,
                gameStarted: false
            };
            if (timer) clearInterval(timer);
        }

        // Individual Mode Functions
        function startIndividualGame() {
            studentName = document.getElementById('student-name').value.trim();  // Add this line
            studentId = document.getElementById('student-id').value.trim();
            if (!studentName || !studentId) {  // Update this condition
                alert('Please enter both your name and student ID');
                return;
            }
            
            gameQuestions = shuffleArray(questions).slice(0, 5);
            currentQuestionIndex = 0;
            individualScore = 0;
            
            hideAllScreens();
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('current-player').textContent = `${studentName} (${studentId})`;  // Update this line
            
            loadIndividualQuestion();
        }

        function loadIndividualQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                showIndividualResults();
                return;
            }
            
            const question = gameQuestions[currentQuestionIndex];
            document.getElementById('question-counter').textContent = `Question ${currentQuestionIndex + 1} of ${gameQuestions.length}`;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('player-score').textContent = individualScore;
            
            updateProgressBar(currentQuestionIndex, gameQuestions.length, 'progress-fill');
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => selectIndividualOption(index);
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('feedback').classList.add('hidden');
            startTimer(() => selectIndividualOption(-1));
        }

        function selectIndividualOption(selectedIndex) {
            if (timer) clearInterval(timer);
            
            const question = gameQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('#options-container .option-button');
            
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === question.correctAnswer) {
                    option.classList.add('option-correct');
                } else if (index === selectedIndex) {
                    option.classList.add('option-wrong');
                }
            });
            
            let feedbackText = '';
            if (selectedIndex === question.correctAnswer) {
                individualScore += 100;
                feedbackText = `<div style="color: #22c55e; font-weight: bold; margin-bottom: 10px;">Correct! +100 points</div>`;
            } else if (selectedIndex === -1) {
                feedbackText = `<div style="color: #ef4444; font-weight: bold; margin-bottom: 10px;">Time's up!</div>`;
            } else {
                feedbackText = `<div style="color: #ef4444; font-weight: bold; margin-bottom: 10px;">Wrong answer!</div>`;
            }
            
            feedbackText += `<div style="color: #666;">${question.feedback}</div>`;
            document.getElementById('feedback-text').innerHTML = feedbackText;
            document.getElementById('feedback').classList.remove('hidden');
            
            setTimeout(() => {
                currentQuestionIndex++;
                loadIndividualQuestion();
            }, 3000);
        }

        function showIndividualResults() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');

            const maxScore = gameQuestions.length * 100;
            const percentage = (individualScore / maxScore) * 100;

            let resultMessage = `
                <div style="background: rgba(1, 70, 137, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <div style="font-size: 3rem; font-weight: bold; color: #014689; margin-bottom: 10px;">${individualScore}/${maxScore}</div>
                    <div style="color: #666; font-size: 1.1rem;">
                        You answered ${Math.round(percentage)}% of questions correctly!<br>
                        ${currentQuestionIndex} out of ${gameQuestions.length} questions completed.
                    </div>
                </div>
            `;

            if (individualScore === maxScore) {
                resultMessage += `
                    <div style="background: #014689; color: white; padding: 20px; border-radius: 10px; text-align: center; font-size: 1.2rem;">
                        Congratulations! You achieved a perfect score. Please collect your prize.
                    </div>
                `;
            }

            document.getElementById('results-title').textContent = `Final Results for ${studentName}`;
            document.getElementById('results-content').innerHTML = resultMessage;
        }

        // PvP Mode Functions
        function startPvPGame() {
            const player1Name = document.getElementById('player1-name').value.trim();
            const player2Name = document.getElementById('player2-name').value.trim();
            
            if (!player1Name || !player2Name) {
                alert('Please enter names for both players');
                return;
            }
            
            pvpPlayers.player1.name = player1Name;
            pvpPlayers.player2.name = player2Name;
            pvpPlayers.player1.score = 0;
            pvpPlayers.player2.score = 0;
            
            gameQuestions = shuffleArray(questions).slice(0, 5);
            currentQuestionIndex = 0;
            
            hideAllScreens();
            document.getElementById('pvp-game-screen').classList.remove('hidden');
            document.getElementById('pvp-player1-name').textContent = player1Name;
            document.getElementById('pvp-player2-name').textContent = player2Name;
            
            loadPvPQuestion();
        }

        function loadPvPQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                showPvPResults();
                return;
            }
            
            const question = gameQuestions[currentQuestionIndex];
            document.getElementById('pvp-question-text').textContent = question.question;
            document.getElementById('pvp-player1-score').textContent = pvpPlayers.player1.score;
            document.getElementById('pvp-player2-score').textContent = pvpPlayers.player2.score;
            
            updateProgressBar(currentQuestionIndex, gameQuestions.length, 'pvp-progress-fill');
            
            // Reset answered states
            pvpPlayers.player1.answered = false;
            pvpPlayers.player2.answered = false;
            
            // Create options for both players
            const player1Options = document.getElementById('pvp-player1-options');
            const player2Options = document.getElementById('pvp-player2-options');
            
            player1Options.innerHTML = '';
            player2Options.innerHTML = '';
            
            question.options.forEach((option, index) => {
                // Player 1 options
                const button1 = document.createElement('button');
                button1.className = 'option-button';
                button1.textContent = option;
                button1.onclick = () => selectPvPOption(1, index);
                player1Options.appendChild(button1);
                
                // Player 2 options
                const button2 = document.createElement('button');
                button2.className = 'option-button';
                button2.textContent = option;
                button2.onclick = () => selectPvPOption(2, index);
                player2Options.appendChild(button2);
            });
            
            startTimer(() => {
                if (!pvpPlayers.player1.answered) selectPvPOption(1, -1);
                if (!pvpPlayers.player2.answered) selectPvPOption(2, -1);
            });
        }

        function selectPvPOption(player, selectedIndex) {
            const question = gameQuestions[currentQuestionIndex];
            const playerData = pvpPlayers[`player${player}`];
            
            if (playerData.answered) return;
            
            playerData.answered = true;
            
            const optionsContainer = document.getElementById(`pvp-player${player}-options`);
            const options = optionsContainer.querySelectorAll('.option-button');
            
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === question.correctAnswer) {
                    option.classList.add('option-correct');
                } else if (index === selectedIndex) {
                    option.classList.add('option-wrong');
                }
            });
            
            if (selectedIndex === question.correctAnswer) {
                playerData.score += 100;
                document.getElementById(`pvp-player${player}-score`).textContent = playerData.score;
            }
            
            // Check if both players have answered
            if (pvpPlayers.player1.answered && pvpPlayers.player2.answered) {
                if (timer) clearInterval(timer);
                setTimeout(() => {
                    currentQuestionIndex++;
                    loadPvPQuestion();
                }, 3000);
            }
        }

        function showPvPResults() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');

            const winner = pvpPlayers.player1.score > pvpPlayers.player2.score ?
                pvpPlayers.player1 : pvpPlayers.player2;
            const loser = pvpPlayers.player1.score > pvpPlayers.player2.score ?
                pvpPlayers.player2 : pvpPlayers.player1;

            let resultText = '';
            if (winner.score === loser.score) {
                resultText = "It's a tie!";
            } else {
                resultText = `${winner.name} wins!`;
            }

            let prizeMessage = '';
            if (pvpPlayers.player1.score === 500) {
                prizeMessage += `
                    <div style="background: #014689; color: white; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center; font-size: 1.1rem;">
                        Congratulations ${pvpPlayers.player1.name}! You achieved a perfect score. Please collect your prize.
                    </div>
                `;
            }
            if (pvpPlayers.player2.score === 500) {
                prizeMessage += `
                    <div style="background: #014689; color: white; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center; font-size: 1.1rem;">
                        Congratulations ${pvpPlayers.player2.name}! You achieved a perfect score. Please collect your prize.
                    </div>
                `;
            }

            document.getElementById('results-title').textContent = resultText;
            document.getElementById('results-content').innerHTML = `
                <div style="background: rgba(1, 70, 137, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #014689; margin-bottom: 10px;">${pvpPlayers.player1.name}</div>
                            <div style="font-size: 2rem; font-weight: bold; color: ${pvpPlayers.player1.score >= pvpPlayers.player2.score ? '#22c55e' : '#ef4444'};">${pvpPlayers.player1.score}</div>
                        </div>
                        <div style="text-align: center; font-size: 2rem; color: #666;">VS</div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #014689; margin-bottom: 10px;">${pvpPlayers.player2.name}</div>
                            <div style="font-size: 2rem; font-weight: bold; color: ${pvpPlayers.player2.score >= pvpPlayers.player1.score ? '#22c55e' : '#ef4444'};">${pvpPlayers.player2.score}</div>
                        </div>
                    </div>
                    <div style="color: #666; font-size: 1.1rem;">
                        ${currentQuestionIndex} questions completed
                    </div>
                </div>
                ${prizeMessage}
            `;
        }

        // Group Mode Functions
        function createRoom() {
            groupRoom.code = generateRoomCode();
            groupRoom.host = true;
            groupRoom.participants = [];
            
            hideAllScreens();
            document.getElementById('group-room').classList.remove('hidden');
            document.getElementById('room-code').textContent = groupRoom.code;
            
            updateParticipantsList();
            
            // Simulate host joining
            setTimeout(() => {
                addParticipant('Host', true);
            }, 500);
        }

        function joinRoom() {
            hideAllScreens();
            document.getElementById('join-room').classList.remove('hidden');
        }

        function backToGroupSetup() {
            hideAllScreens();
            document.getElementById('group-setup').classList.remove('hidden');
        }

        function joinRoomWithCode() {
            const roomCode = document.getElementById('room-code-input').value.trim().toUpperCase();
            const participantName = document.getElementById('participant-name').value.trim();
            
            if (!roomCode || !participantName) {
                alert('Please enter both room code and your name');
                return;
            }
            
            // Simulate joining room (in real app, this would be server-side)
            groupRoom.code = roomCode;
            groupRoom.host = false;
            
            alert(`Joined room ${roomCode} as ${participantName}`);
            // In a real implementation, this would connect to the host's room
        }

        function addParticipant(name, isHost = false) {
            const participant = {
                name: name,
                score: 0,
                isHost: isHost
            };

            groupRoom.participants.push(participant);
            updateParticipantsList();

            const startBtn = document.getElementById('start-group-btn');
            if (groupRoom.participants.length >= 1) {  // Allow start with just 1
                startBtn.disabled = false;
                startBtn.textContent = 'Start Game';
            }
        }

        function updateParticipantsList() {
            const container = document.getElementById('participants-container');
            const count = document.getElementById('participant-count');
            
            count.textContent = groupRoom.participants.length;
            container.innerHTML = '';
            
            groupRoom.participants.forEach((participant, index) => {
                const div = document.createElement('div');
                div.className = 'participant';
                div.innerHTML = `
                    <span>${participant.name} ${participant.isHost ? '(Host)' : ''}</span>
                    <span style="color: #014689; font-weight: bold;">${participant.score}</span>
                `;
                container.appendChild(div);
            });
        }

        function startGroupGame() {
            if (groupRoom.participants.length < 1) {
                alert('Need at least 1 participants to start');
                return;
            }
            
            gameQuestions = shuffleArray(questions).slice(0, 5);
            currentQuestionIndex = 0;
            groupRoom.gameStarted = true;
            
            hideAllScreens();
            document.getElementById('group-game-screen').classList.remove('hidden');
            
            loadGroupQuestion();
        }

        function loadGroupQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                showGroupResults();
                return;
            }
            
            const question = gameQuestions[currentQuestionIndex];
            document.getElementById('group-question-text').textContent = question.question;
            
            updateProgressBar(currentQuestionIndex, gameQuestions.length, 'group-progress-fill');
            
            const optionsContainer = document.getElementById('group-options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => selectGroupOption(index);
                optionsContainer.appendChild(button);
            });
            
            updateGroupLeaderboard();
            startTimer(() => selectGroupOption(-1));
        }

        function selectGroupOption(selectedIndex) {
            if (timer) clearInterval(timer);
            
            const question = gameQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('#group-options-container .option-button');
            
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === question.correctAnswer) {
                    option.classList.add('option-correct');
                } else if (index === selectedIndex) {
                    option.classList.add('option-wrong');
                }
            });
            
            // Simulate other participants answering
            groupRoom.participants.forEach(participant => {
                if (!participant.isHost) {
                    const randomAnswer = Math.floor(Math.random() * 4);
                    if (randomAnswer === question.correctAnswer) {
                        participant.score += 100;
                    }
                }
            });
            
            // Update host score
            if (selectedIndex === question.correctAnswer) {
                groupRoom.participants[0].score += 100;
            }
            
            updateGroupLeaderboard();
            
            setTimeout(() => {
                currentQuestionIndex++;
                loadGroupQuestion();
            }, 3000);
        }

        function updateGroupLeaderboard() {
            const container = document.getElementById('leaderboard-container');
            const sortedParticipants = [...groupRoom.participants].sort((a, b) => b.score - a.score);
            
            container.innerHTML = '';
            
            sortedParticipants.forEach((participant, index) => {
                const div = document.createElement('div');
                div.className = 'leaderboard-item';
                div.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span class="rank">${index + 1}</span>
                        <span>${participant.name}</span>
                    </div>
                    <span style="color: #014689; font-weight: bold;">${participant.score}</span>
                `;
                container.appendChild(div);
            });
        }

        function showGroupResults() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');
            
            const winner = groupRoom.participants.reduce((prev, current) => 
                prev.score > current.score ? prev : current
            );
            
            document.getElementById('results-title').textContent = `${winner.name} wins!`;
            
            const leaderboardHtml = groupRoom.participants
                .sort((a, b) => b.score - a.score)
                .map((participant, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: ${index === 0 ? 'rgba(254, 176, 65, 0.2)' : 'rgba(1, 70, 137, 0.1)'}; border-radius: 10px; margin: 10px 0;">
                        <div style="display: flex; align-items: center;">
                            <span style="font-size: 1.5rem; font-weight: bold; color: #014689; width: 40px;">${index + 1}</span>
                            <span style="font-size: 1.2rem; color: #333;">${participant.name}</span>
                        </div>
                        <span style="font-size: 1.5rem; font-weight: bold; color: #014689;">${participant.score}</span>
                    </div>
                `).join('');
            
            document.getElementById('results-content').innerHTML = `
                <div style="background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <h3 style="color: #014689; margin-bottom: 20px; font-size: 1.5rem;">Final Leaderboard</h3>
                    ${leaderboardHtml}
                </div>
            `;
        }

        // Utility Functions
        function playAgain() {
            switch (currentMode) {
                case 'individual':
                    startIndividualGame();
                    break;
                case 'pvp':
                    startPvPGame();
                    break;
                case 'group':
                    startGroupGame();
                    break;
            }
        }

        // Overall Leaderboard Data
        const leaderboardNames = [
            'Alex Chen', 'Sarah Lim', 'David Wong', 'Michelle Tan', 'Ryan Kumar',
            'Jessica Lee', 'Marcus Ng', 'Priya Sharma', 'Kevin Ong', 'Amanda Teo',
            'Daniel Koh', 'Natasha Patel', 'Jonathan Sim', 'Rachel Chan', 'Arjun Singh',
            'Stephanie Wu', 'Brandon Lau', 'Vanessa Goh', 'Timothy Yap', 'Chloe Lim'
        ];

        let overallLeaderboard = [];

        // Initialize overall leaderboard
        function initializeOverallLeaderboard() {
            overallLeaderboard = [];
            
            // Generate random leaderboard data
            const shuffledNames = shuffleArray(leaderboardNames);
            
            for (let i = 0; i < 10; i++) {
                const baseScore = Math.floor(Math.random() * 800) + 200; // 200-1000 range
                const gamesPlayed = Math.floor(Math.random() * 15) + 1; // 1-15 games
                
                overallLeaderboard.push({
                    name: shuffledNames[i],
                    score: baseScore,
                    gamesPlayed: gamesPlayed,
                    averageScore: Math.floor(baseScore / gamesPlayed)
                });
            }
            
            // Sort by total score
            overallLeaderboard.sort((a, b) => b.score - a.score);
            updateOverallLeaderboard();
        }

        // Update overall leaderboard display
        function updateOverallLeaderboard() {
            const container = document.getElementById('overall-leaderboard-container');
            
            container.innerHTML = '';
            
            overallLeaderboard.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'leaderboard-item';
                div.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px;
                    background: ${index < 3 ? 'rgba(254, 176, 65, 0.15)' : 'rgba(1, 70, 137, 0.05)'};
                    border-radius: 10px;
                    margin: 8px 0;
                    border-left: 4px solid ${index === 0 ? '#feb041' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : '#014689'};
                    transition: all 0.3s ease;
                `;
                
                div.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 1.5rem; font-weight: bold; color: #014689; width: 50px; text-align: center;">
                            ${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : (index + 1)}
                        </span>
                        <div style="margin-left: 15px;">
                            <div style="font-size: 1.1rem; font-weight: 600; color: #333;">${player.name}</div>
                            <div style="font-size: 0.9rem; color: #666;">${player.gamesPlayed} games • Avg: ${player.averageScore}</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.3rem; font-weight: bold; color: #014689;">${player.score}</div>
                        <div style="font-size: 0.8rem; color: #666;">total points</div>
                    </div>
                `;
                
                // Add hover effect
                div.addEventListener('mouseenter', function() {
                    this.style.background = index < 3 ? 'rgba(254, 176, 65, 0.25)' : 'rgba(1, 70, 137, 0.1)';
                    this.style.transform = 'translateX(5px)';
                });
                
                div.addEventListener('mouseleave', function() {
                    this.style.background = index < 3 ? 'rgba(254, 176, 65, 0.15)' : 'rgba(1, 70, 137, 0.05)';
                    this.style.transform = 'translateX(0)';
                });
                
                container.appendChild(div);
            });
        }

        // Add player to overall leaderboard
        function addToOverallLeaderboard(playerName, score) {
            // Check if player already exists
            const existingPlayer = overallLeaderboard.find(p => p.name === playerName);
            
            if (existingPlayer) {
                existingPlayer.score += score;
                existingPlayer.gamesPlayed += 1;
                existingPlayer.averageScore = Math.floor(existingPlayer.score / existingPlayer.gamesPlayed);
            } else {
                overallLeaderboard.push({
                    name: playerName,
                    score: score,
                    gamesPlayed: 1,
                    averageScore: score
                });
            }
            
            // Keep only top 10 and sort
            overallLeaderboard.sort((a, b) => b.score - a.score);
            overallLeaderboard = overallLeaderboard.slice(0, 10);
            
            updateOverallLeaderboard();
        }

        // Refresh leaderboard with new random data
        function refreshLeaderboard() {
            const button = document.querySelector('button[onclick="refreshLeaderboard()"]');
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            button.disabled = true;
            
            setTimeout(() => {
                initializeOverallLeaderboard();
                button.innerHTML = originalText;
                button.disabled = false;
            }, 1000);
        }

        // Initialize leaderboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeOverallLeaderboard();
        });

        // Update the existing showIndividualResults function to add to leaderboard
        function showIndividualResults() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');

            const maxScore = gameQuestions.length * 100;
            const percentage = (individualScore / maxScore) * 100;

            // Add to overall leaderboard
            addToOverallLeaderboard(studentName, individualScore);

            let resultMessage = `
                <div style="background: rgba(1, 70, 137, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <div style="font-size: 3rem; font-weight: bold; color: #014689; margin-bottom: 10px;">${individualScore}/${maxScore}</div>
                    <div style="color: #666; font-size: 1.1rem;">
                        You answered ${Math.round(percentage)}% of questions correctly!<br>
                        ${currentQuestionIndex} out of ${gameQuestions.length} questions completed.
                    </div>
                </div>
            `;

            if (individualScore === maxScore) {
                resultMessage += `
                    <div style="background: #014689; color: white; padding: 20px; border-radius: 10px; text-align: center; font-size: 1.2rem;">
                        Congratulations! You achieved a perfect score. Please collect your prize.
                    </div>
                `;
            }

            document.getElementById('results-title').textContent = `Final Results for ${studentName}`;
            document.getElementById('results-content').innerHTML = resultMessage;
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            // Add some sample participants for demo purposes
            if (groupRoom.host) {
                setTimeout(() => {
                    addParticipant('Alex Chen');
                    addParticipant('Sarah Lim');
                    addParticipant('David Wong');
                }, 1000);
            }
        });
    </script>
</body>
</html>
